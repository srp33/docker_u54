description: Sort and index a BAM file.
args:
    - BAM_FILE:
        default: "Null"
        opts: "-b | --bam_file"
        description: "Path to a BAM file."
        required: True
        example: "-b SampleA.bam"
    - BY_NAME:
        default: False
        opts: "-n, --sort_by_name"
        description: "Sort by read name (rather than by coordinates)."
        required: False
        acceptable_values:
            - False
            - True
        example: "-n True"
    - OUTPUT:
        default: "Null"
        opts: "-o | --output"
        description: "Name of the output file."
        required: True
        example: "-o SampleA_regionA.bam"
    - THREADS:
        default: 1
        opts: "-t | --nthreads"
        description: "The number of threads that should be used."
        required: False
        example: "-t 4"
volumes:
    - bam_files:
        description: "Directory where the BAM file is stored."
        permissions: Read
    - output_data:
        description: "Directory where the output file will be stored."
        permissions: ReadWrite
command_template: |
    BY_NAME_PARAM=
    if [[ "$BY_NAME" == "True" ]]
    then
      BY_NAME_PARAM="-t"
    fi

    sambamba sort \
      -t ${THREADS} \
      ${BY_NAME_PARAM} \
      -o /data/output_data/"${OUTPUT}" \
      /data/bam_files/"${BAM_FILE}"
receipt_commands: |
    get_bash_version
    get_conda_version sambamba